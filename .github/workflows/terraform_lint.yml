name: Terraform Lint and Plan
on:
    workflow_dispatch:

jobs:
    Lint:
        name: Lint
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: terraform
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
            
            - name: Cache Plugin Directory
              uses: actions/cache@v4
              with:
                path: ~/.tflint.d/plugins
                key: ${{ runner.os }}-tflint-${{ hashFiles('terraform/.tflint.hcl') }}

            - name: Set up TFlint
              uses: terraform-linters/setup-tflint@v4
              with:
                tflint_version: v0.57.0
            - name: Show version
              run: tflint --version
            
            - name: Init TFlint
              run: tflint --init
              env:
                GITHUB_TOKEN: ${{ github.token }}

            - name: Run TFlint
              run: tflint --recursive -f compact
